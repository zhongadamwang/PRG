# {{pascalEntityName}} Repository

## Overview

This repository provides data access operations for {{entityName}} entities following eServiceCloud clean architecture patterns. It implements the Repository pattern with separation of concerns and proper dependency management.

## Structure

- **Interface**: `I{{pascalEntityName}}Repository` - Defines the contract for repository operations
- **Implementation**: `{{pascalEntityName}}Repository` - Concrete implementation inheriting from `CommonRepository`


Sesi.SanjelData.Entities.BusinessEntities
Sesi.SanjelData.Services.Interfaces

## Features

- ✅ Standard CRUD operations (Create, Read, Update, Delete)
- ✅ Paged and filtered listing with LINQ expressions
- ✅ Async/await support with CancellationToken
- ✅ Automatic entity-to-model mapping via `IMappingService`
- ✅ Model validation through `IValidationService`
- ✅ Error handling and logging integration
- ✅ Scoped dependency injection registration

## Base Repository Capabilities

The repository inherits from `CommonRepository<TEntity, TModel, TDataService>` providing:

### Standard Operations
```csharp
// Get by ID
Task<{{pascalEntityName}}Model?> GetByIdAsync(int id, CancellationToken ct = default)

// List with filtering
Task<IReadOnlyList<{{pascalEntityName}}Model>> ListAsync(Expression<Func<{{pascalEntityName}}Entity, bool>>? filter = null, CancellationToken ct = default)

// Paged listing
Task<PagedResult<{{pascalEntityName}}Model>> ListPagedAsync(int page, int pageSize, Expression<Func<{{pascalEntityName}}Entity, bool>>? filter = null, CancellationToken ct = default)

// Create new entity
Task<Result<{{pascalEntityName}}Model>> CreateAsync({{pascalEntityName}}Model model, CancellationToken ct = default)

// Update existing entity  
Task<Result<{{pascalEntityName}}Model>> UpdateAsync({{pascalEntityName}}Model model, CancellationToken ct = default)

// Delete entity
Task<Result> DeleteAsync(int id, CancellationToken ct = default)
```

## Usage Example

### Service Layer Integration
```csharp
public class {{pascalEntityName}}Service
{
    private readonly I{{pascalEntityName}}Repository _repository;
    
    public {{pascalEntityName}}Service(I{{pascalEntityName}}Repository repository)
    {
        _repository = repository;
    }
    
    public async Task<Result<{{pascalEntityName}}Model>> GetByIdAsync(int id)
    {
        var entity = await _repository.GetByIdAsync(id);
        return entity != null 
            ? Result.Success(entity)
            : Result.Failure<{{pascalEntityName}}Model>("{{entityName}} not found");
    }
    
    public async Task<PagedResult<{{pascalEntityName}}Model>> ListPagedAsync(int page, int pageSize)
    {
        return await _repository.ListPagedAsync(page, pageSize);
    }
}
```

### Dependency Injection Registration
```csharp
// In Program.cs or service registration
services.AddScopedWithTimeLogging<I{{pascalEntityName}}Repository, {{pascalEntityName}}Repository>();
```

## Custom Query Extensions

To add domain-specific queries, extend both interface and implementation:

```csharp
// In I{{pascalEntityName}}Repository interface
Task<IReadOnlyList<{{pascalEntityName}}Model>> ListByStatusAsync(string status, CancellationToken ct = default);

// In {{pascalEntityName}}Repository implementation  
public async Task<IReadOnlyList<{{pascalEntityName}}Model>> ListByStatusAsync(string status, CancellationToken ct = default)
{
    Expression<Func<{{pascalEntityName}}Entity, bool>> filter = e => e.Status == status;
    return await this.ListAsync(filter, ct).ConfigureAwait(false);
}
```

## Architecture Compliance

This repository follows eServiceCloud patterns:

- **Single Responsibility**: Pure data access operations only
- **Dependency Inversion**: Depends on abstractions (interfaces) not concretions
- **Separation of Concerns**: No business logic, only data access and mapping
- **Error Boundaries**: Repository-level error handling without UI coupling
- **Testability**: Interface-based design supports mocking and unit testing

## Dependencies

- **{{dataServiceInterface}}**: MetaShare data service for entity operations
- **IMappingService**: Core service for entity-to-model transformation
- **IValidationService**: Core service for model validation and error aggregation

## Best Practices

1. **Service Layer Access**: Only inject repositories into application services, never into pages/components
2. **Async Patterns**: Always use async methods with CancellationToken support
3. **Expression Filtering**: Use LINQ expressions for type-safe query filtering
4. **Error Propagation**: Let base repository handle mapping and validation errors
5. **Resource Management**: Repository automatically handles resource cleanup and connection management

## Testing

Repository testing should focus on:
- Interface contract compliance
- Custom query method behavior
- Error handling scenarios  
- Integration with base repository functionality
- Dependency injection registration

---

Generated by repository-creator skill • eServiceCloud Architecture • {{timestamp}}